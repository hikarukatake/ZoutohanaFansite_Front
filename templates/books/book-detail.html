<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>書評の詳細</title>
    <link rel="stylesheet" th:href="@{/css/main.css}" href="../css/main.css">
    <link rel="stylesheet" th:href="@{/css/books/book-detail.css}" href="../css/books/book-detail.css">
</head>

<body>
    <div class="container">
        <div th:replace="~{layout :: header}"></div>
        <div class="breadcrumb-box">
            <div class="breadcrumb">ホーム</div>
            <div class="breadcrumb-middle">></div>
            <div class="breadcrumb">マイページ</div>
            <div class="breadcrumb-middle">></div>
            <div class="breadcrumb">書評の詳細</div>
        </div>

        <div class="settings-icon" th:if="${project.status.name().equals('DURING_SUBMISSION')}">
            <div class="gear-radius">
                <img th:src="@{/img/gear.png}" src="../img/gear.png" alt="" width="18px">
            </div>
        </div>

        <section class="card">
            <div class="review-container">
                <!-- タイトル -->
                <div class="review-title" th:text="${review.reviewTitle}">
                    小学校の頃から大好きな作品！
                </div>

                <!-- 投稿日 -->
                <div class="review-meta" th:text="${'投稿日 : ' + #temporals.format(review.updatedAt, 'yyyy.MM.dd')}">
                    投稿日：2025.01.01
                    <span th:text="${'#' + project.name}">#文庫X 2.0</span>
                </div>

                <!-- 本カード -->
                <div class="book-card">
                    <img class="book-image" th:src="'https://ndlsearch.ndl.go.jp/thumbnail/' + ${review.bookIsbn} +'.jpg'"></img>

                    <div class="book-info">
                        <h3 th:text="${review.bookTitle}">象と花について</h3>
                        <div class="book-details">
                            <p th:text="${'著者名 : ' + review.bookAuthor}">著者名：象と花</p>
                            <p th:text="${'出版社 : ' + review.bookPublisher}">出版社：象と花プロジェクト</p>
                        </div>
                    </div>
                </div>
                <hr style="margin: 30px 0;">

                <!-- 書評本文 -->
                <div class="review-text" th:text="${review.reviewContent}">
                    最近の読書の中でも特に心に残った一冊でした。<br>
                    読み進めるほど登場人物の気持ちに寄り添えるようになり、
                    自分の日常を見つめ直すきっかけにもなりました。<br>
                    読み終えたあとも温かい余韻が残り、しばらくその世界に浸っていたくなる作品でした。<br>
                    読み進めるほど共感する場面が増え、自分の経験と重ね合わせながら楽しめました。
                    静かで優しい雰囲気の中に、少しずつ変わっていく気持ちが繊細に表現されていて、
                    読んでいて胸が温かくなる作品でした。
                </div>
            </div>
        </section>
        <div class="page-nav">
            <a th:href="@{/mypage}" href="#" class="nav-center">
                マイページへ
            </a>
        </div>


        <!-- ヘッダーモーダル -->
        <div class="overlay-menu" id="overlayMenu">
            <div class="close-btn" id="menuClose">×</div>
            <img src="../img/象と花-white-color.png" class="" style="width: 5rem;" alt="">
            <ul class="menu-list">
                <li class="menu-item">お知らせ</li>

                <li class="menu-item">企画一覧</li>

                <li class="menu-item">象と花プロジェクト</li>

                <li class="menu-item">お問い合わせ</li>

                <li class="menu-item">ログイン</li>
            </ul>
            <div class="imgs">
                <img src="../img/instagram-white.png" class="imgs-icon" alt="">
                <img src="../img/facebook-white.png" class="imgs-width" alt="">
                <img src="../img/x-white.png" class="imgs-width" alt="">
            </div>
        </div>
        <div class="settings-overlay" id="settingsModal">
            <div class="settings-content">
                <a th:href="@{/review/edit/{id}(id=${review.id})}" href="#" class="settings-row">
                    <span class="settings-icon-img">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </span>
                    <span class="settings-text">書評編集</span>
                    <span class="settings-arrow">&gt;</span>
                </a>

                <div class="settings-line"></div>

                <a href="#" class="settings-row" id="openDeleteModal">
                    <span class="settings-icon-img">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" y1="8" x2="20" y2="14"></line>
                            <line x1="23" y1="11" x2="17" y2="11"></line>
                        </svg>
                    </span>
                    <span class="settings-text">書評削除</span>
                    <span class="settings-arrow">&gt;</span>
                </a>
            </div>
        </div>
        <!-- 削除確認モーダル -->
        <div class="delete-overlay" id="deleteModal">
            <div class="delete-content">
                <h3 class="delete-title">本当に書評を削除しますか？</h3>
                <p class="delete-text">
                    書評を削除すると、復元することはできません。
                </p>

                <div class="delete-buttons">
                    <button class="btn-back" id="deleteCancel">もどる</button>
                    <form th:action="@{/review/delete/{id}(id=${review.id})}" method="post">
                        <button type="submit" class="btn-delete">削除する</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- フッター -->
        <div th:replace="~{layout :: footer}"></div>
    </div>



    <script>
        // ▼▼▼ 要素を取得 ▼▼▼
        const menuOpen = document.getElementById('menuOpen');   // ハンバーガーメニューのアイコン
        const menuClose = document.getElementById('menuClose'); // ハンバーガーメニューの閉じるボタン
        const overlayMenu = document.getElementById('overlayMenu'); // ハンバーガーメニュー本体

        const gearButton = document.querySelector('.settings-icon'); // 歯車アイコン
        const settingsModal = document.getElementById('settingsModal'); // 設定モーダル本体

        // ▼▼▼ ハンバーガーメニューの動作（既存のまま） ▼▼▼
        menuOpen.addEventListener('click', () => {
            overlayMenu.classList.add('active');
        });

        menuClose.addEventListener('click', () => {
            overlayMenu.classList.remove('active');
        });

        // 1. 歯車を押したときの動作
        gearButton.addEventListener('click', (e) => {
            // add ではなく toggle にすることで、「開く/閉じる」を繰り返せます
            settingsModal.classList.toggle('active');
        });

        // 2. モーダルの背景（黒い部分）を押したときの動作
        settingsModal.addEventListener('click', (e) => {
            // クリックした場所が「モーダル本体(settingsModal)」そのものだった場合のみ閉じる
            // （中の白い箱をクリックしても閉じないようにする判定）
            if (e.target === settingsModal) {
                settingsModal.classList.remove('active');
            }
        });
    </script>
    <script>
        const openDeleteModal = document.getElementById('openDeleteModal');
        const deleteModal = document.getElementById('deleteModal');
        const deleteCancel = document.getElementById('deleteCancel');

        // 削除モーダルを開く
        openDeleteModal.addEventListener('click', (e) => {
            e.preventDefault();
            deleteModal.classList.add('active');
            settingsModal.classList.remove('active'); // 設定モーダルを閉じる
        });

        // 「もどる」ボタン
        deleteCancel.addEventListener('click', () => {
            deleteModal.classList.remove('active');
        });

        // 背景クリックで閉じる
        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                deleteModal.classList.remove('active');
            }
        });
    </script>

    <script src="../js/mypage.js"></script>
</body>

</html>